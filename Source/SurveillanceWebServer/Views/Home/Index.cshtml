@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>This is the <a href="https://github.com/Leal-Daniel/PetSurveillanceBot">Surveillance Bot</a> livestream (when active).</p>
</div>

<div class="video-rectangle">
    <canvas id="videoCanvas" width="640" height="480"></canvas>
</div>


<script>
    const canvas = document.getElementById('videoCanvas');
    const context = canvas.getContext('2d');
    // Send a request to a server to get the public IP address
    fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            const ipAddress = data.ip;
            const ws = new WebSocket('ws://' + ipAddress + ':1225/ws');

            ws.binaryType = 'arraybuffer';

            ws.onmessage = function (event) {
                const blob = new Blob([event.data], { type: 'image/jpeg' });
                const url = URL.createObjectURL(blob);

                const img = new Image();
                img.onload = function () {
                    context.drawImage(img, 0, 0);
                    URL.revokeObjectURL(url);
                };
                img.src = url;
            };

            ws.onopen = function () {
                console.log("WebSocket connection established");
            };

            ws.onerror = function (error) {
                console.error("WebSocket error: " + error.message);
            };

            ws.onclose = function () {
                console.log("WebSocket connection closed");
            };
        })
        .catch(error => {
            console.error("Error fetching public IP address:", error);
        });
</script>